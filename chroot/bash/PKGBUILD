pkgname=chroot-bash
mainver=4.4
pkgver=${mainver}.023
pkgrel=1
arch=('x86_64' 'aarch64')
source=(http://ftpmirror.gnu.org/gnu/bash/bash-${mainver}.tar.gz
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-001
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-002
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-003
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-004
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-005
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-006
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-007
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-008
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-009
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-010
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-011
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-012
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-013
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-014
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-015
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-016
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-017
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-018
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-019
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-020
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-021
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-022
	http://ftpmirror.gnu.org/gnu/bash/bash-4.4-patches/bash44-023)

prepare() {
	cd bash-${mainver}
	patch -p0 -i $srcdir/bash44-001
	patch -p0 -i $srcdir/bash44-002
	patch -p0 -i $srcdir/bash44-003
	patch -p0 -i $srcdir/bash44-004
	patch -p0 -i $srcdir/bash44-005
	patch -p0 -i $srcdir/bash44-006
	patch -p0 -i $srcdir/bash44-007
	patch -p0 -i $srcdir/bash44-008
	patch -p0 -i $srcdir/bash44-009
	patch -p0 -i $srcdir/bash44-010
	patch -p0 -i $srcdir/bash44-011
	patch -p0 -i $srcdir/bash44-012
	patch -p0 -i $srcdir/bash44-013
	patch -p0 -i $srcdir/bash44-014
	patch -p0 -i $srcdir/bash44-015
	patch -p0 -i $srcdir/bash44-016
	patch -p0 -i $srcdir/bash44-017
	patch -p0 -i $srcdir/bash44-018
	patch -p0 -i $srcdir/bash44-019
	patch -p0 -i $srcdir/bash44-020
	patch -p0 -i $srcdir/bash44-021
	patch -p0 -i $srcdir/bash44-022
	patch -p0 -i $srcdir/bash44-023

cat > config.cache << "EOF"
ac_cv_func_mmap_fixed_mapped=yes
ac_cv_func_strcoll_works=yes
ac_cv_func_working_mktime=yes
bash_cv_func_sigsetjmp=present
bash_cv_getcwd_malloc=yes
bash_cv_job_control_missing=present
bash_cv_printf_a_format=yes
bash_cv_sys_named_pipes=present
bash_cv_ulimit_maxfds=yes
bash_cv_under_sys_siglist=yes
bash_cv_unusable_rtsigs=no
gt_cv_int_divbyzero_sigfpe=yes
EOF
}

build() {
	cd bash-${mainver}
	./configure \
		--prefix=/tools \
		--build=$XHOST \
		--host=$XTARGET \
		--cache-file=config.cache \
		--without-bash-malloc \
		--disable-nls
	make -j1
}

package() {
	cd bash-${mainver}
	install -D bash $pkgdir/tools/bin/bash
}
