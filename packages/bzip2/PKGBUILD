# Maintainer: protonesso <nagakamira@gmail.com>
# Contributor: protonesso <nagakamira@gmail.com>

pkgname=bzip2
pkgver=1.0.6
pkgrel=1
pkgdesc="A high-quality data compression program"
arch=('x86_64' 'i586' 'aarch64' 'arm' 'riscv64' 'riscv32')
url="http://sources.redhat.com/bzip2"
license=('custom')
depends=('glibc')
source=(https://fossies.org/linux/misc/$pkgname-$pkgver.tar.gz
	bzip2.patch
	CVE-2016-3189.patch)
md5sums=('00b516f4704d4a7cb50a1d97e6e8e15b'
         'ab2b0d7367fc6f14a3d943a3861ad2c1'
         '3b17081b71204ddfaa1cef6f5f9d8747')

prepare() {
	cd $pkgname-$pkgver
	patch -Np1 -i $srcdir/bzip2.patch
	patch -p1 -i $srcdir/CVE-2016-3189.patch
}

build() {
	cd $pkgname-$pkgver
	make
	make -f Makefile-libbz2_so
}

package() {
	cd $pkgname-$pkgver
	make PREFIX=$pkgdir/usr install
	make -f Makefile-libbz2_so PREFIX=$pkgdir/usr install
}
