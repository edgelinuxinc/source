# Maintainer: protonesso <nagakamira@gmail.com>
# Contributor: protonesso <nagakamira@gmail.com>

pkgname=ca-certificates
pkgver=0.10.1
pkgrel=1
pkgdesc="Common CA certificates"
arch=('any')
url="https://github.com/protonesso/ca-certs/blob/master/README"
license=('custom')
depends=('libressl' 'p11-kit')
source=("https://github.com/protonesso/ca-certs/archive/$pkgver.tar.gz"
	'http://www.cacert.org/certs/root.crt'
	'http://www.cacert.org/certs/class3.crt'
	'ca-certificates.hook')
md5sums=('SKIP'
	 'SKIP'
	 'SKIP'
	 'SKIP')

package() {
	mkdir -p $pkgdir/etc/ssl/certs
	mkdir -p $pkgdir/etc/ssl/local

	openssl x509 -in $SRC/root.crt -text -fingerprint -setalias "CAcert Class 1 root" \
		-addtrust serverAuth -addtrust emailProtection -addtrust codeSigning \
		> $pkgdir/etc/ssl/local/CAcert_Class_1_root.pem &&
	openssl x509 -in $SRC/class3.crt -text -fingerprint -setalias "CAcert Class 3 root" \
		-addtrust serverAuth -addtrust emailProtection -addtrust codeSigning \
		> $pkgdir/etc/ssl/local/CAcert_Class_3_root.pem

	cd ca-certs-$pkgver
	make DESTDIR=$pkgdir install

	install -dm755 $pkgdir/usr/share/libalpm/hooks/
	install -m644 $srcdir/ca-certificates.hook $pkgdir/usr/share/libalpm/hooks/

	rm -rf $pkgdir/etc/systemd
}
